<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="741px" preserveAspectRatio="none" style="width:656px;height:741px;background:#FFFFFF;" version="1.1" viewBox="0 0 656 741" width="656px" zoomAndPan="magnify"><defs><filter height="300%" id="f1r2qlwpkt9pj7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="189.5" cy="20" fill="#000000" filter="url(#f1r2qlwpkt9pj7)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><a href="#バリデーション" target="_top" title="#バリデーション" xlink:actuate="onRequest" xlink:href="#バリデーション" xlink:show="new" xlink:title="#バリデーション" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="104" x="137.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="147.5" y="71.1387">バリデーション</text></a><path d="M279.5,108.3867 L279.5,116.9531 L259.5,120.9531 L279.5,124.9531 L279.5,133.5195 A0,0 0 0 0 279.5,133.5195 L620.5,133.5195 A0,0 0 0 0 620.5,133.5195 L620.5,118.3867 L610.5,108.3867 L279.5,108.3867 A0,0 0 0 0 279.5,108.3867 " fill="#FBFB77" filter="url(#f1r2qlwpkt9pj7)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M610.5,108.3867 L610.5,118.3867 L620.5,118.3867 L610.5,108.3867 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="285.5" y="125.4536">実装時は</text><a href="https://www.php.net/manual/ja/language.generators.overview.php" target="_top" title="https://www.php.net/manual/ja/language.generators.overview.php" xlink:actuate="onRequest" xlink:href="https://www.php.net/manual/ja/language.generators.overview.php" xlink:show="new" xlink:title="https://www.php.net/manual/ja/language.generators.overview.php" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="65" x="337.5" y="125.4536">Generator</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="402.5" y="125.4536">を使用し、1レコードずつ読み込む</text><a href="#csvファイル読み込み" target="_top" title="#csvファイル読み込み" xlink:actuate="onRequest" xlink:href="#csvファイル読み込み" xlink:show="new" xlink:title="#csvファイル読み込み" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="140" x="119.5" y="103.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="129.5" y="125.1074">CSVファイル読み込み</text></a><path d="M388,154.7891 L388,170.9219 L368,174.9219 L388,178.9219 L388,195.0547 A0,0 0 0 0 388,195.0547 L592,195.0547 A0,0 0 0 0 592,195.0547 L592,164.7891 L582,154.7891 L388,154.7891 A0,0 0 0 0 388,154.7891 " fill="#FBFB77" filter="url(#f1r2qlwpkt9pj7)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M582,154.7891 L582,164.7891 L592,164.7891 L582,154.7891 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="394" y="171.856">実装時は</text><a href="https://www.php.net/manual/en/function.array-chunk.php" target="_top" title="https://www.php.net/manual/en/function.array-chunk.php" xlink:actuate="onRequest" xlink:href="https://www.php.net/manual/en/function.array-chunk.php" xlink:show="new" xlink:title="https://www.php.net/manual/en/function.array-chunk.php" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="79" x="446" y="171.856">array_chunk</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="525" y="171.856">ではなく</text><a href="https://www.php.net/manual/ja/language.generators.overview.php" target="_top" title="https://www.php.net/manual/ja/language.generators.overview.php" xlink:actuate="onRequest" xlink:href="https://www.php.net/manual/ja/language.generators.overview.php" xlink:show="new" xlink:title="https://www.php.net/manual/ja/language.generators.overview.php" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="65" x="394" y="186.9888">Generator</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="459" y="186.9888">で分割する</text><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="357" x="11" y="157.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="337" x="21" y="179.0762">chunks = array_chunk(CSVファイルレコードリスト, 1000)</text><rect fill="#FFFFFF" filter="url(#f1r2qlwpkt9pj7)" height="423.168" style="stroke:#000000;stroke-width:2.0;" width="589.5" x="50" y="205.0547"/><path d="M175,205.0547 L175,214.3516 L165,224.3516 L50,224.3516 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="53" y="219.0498">foreach(chunks)</text><path d="M446.5,409.5859 L446.5,434.7188 L629.5,434.7188 L629.5,419.5859 L619.5,409.5859 L446.5,409.5859 " fill="#FBFB77" filter="url(#f1r2qlwpkt9pj7)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M619.5,409.5859 L619.5,419.5859 L629.5,419.5859 L619.5,409.5859 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="452.5" y="426.6528">1000レコードずつ登録する</text><a href="#レコードバリデーション" target="_top" title="#レコードバリデーション" xlink:actuate="onRequest" xlink:href="#レコードバリデーション" xlink:show="new" xlink:title="#レコードバリデーション" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="152" x="113.5" y="285.3516"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="132" x="123.5" y="306.4902">レコードバリデーション</text></a><rect fill="#FFA500" filter="url(#f1r2qlwpkt9pj7)" height="264.9023" style="stroke:#000000;stroke-width:2.0;" width="305" x="109.5" y="329.3203"/><path d="M231.5,329.3203 L231.5,338.6172 L221.5,348.6172 L109.5,348.6172 " fill="none" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="112.5" y="343.3154">トランザクション</text><path d="M269.5,464.2188 L269.5,489.3516 L394.5,489.3516 L394.5,474.2188 L384.5,464.2188 L269.5,464.2188 " fill="#FBFB77" filter="url(#f1r2qlwpkt9pj7)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384.5,464.2188 L384.5,474.2188 L394.5,474.2188 L384.5,464.2188 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><a href="https://www.php.net/manual/ja/pdo.transactions.php" target="_top" title="https://www.php.net/manual/ja/pdo.transactions.php" xlink:actuate="onRequest" xlink:href="https://www.php.net/manual/ja/pdo.transactions.php" xlink:show="new" xlink:title="https://www.php.net/manual/ja/pdo.transactions.php" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="104" x="275.5" y="481.2856">トランザクション</text></a><a href="#トランザクション開始" target="_top" title="#トランザクション開始" xlink:actuate="onRequest" xlink:href="#トランザクション開始" xlink:show="new" xlink:title="#トランザクション開始" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="140" x="119.5" y="365.6172"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="129.5" y="386.7559">トランザクション開始</text></a><a href="#xxxテーブル登録" target="_top" title="#xxxテーブル登録" xlink:actuate="onRequest" xlink:href="#xxxテーブル登録" xlink:show="new" xlink:title="#xxxテーブル登録" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="116" x="131.5" y="425.3164"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="141.5" y="446.4551">XXXテーブル登録</text></a><a href="#oooテーブル登録" target="_top" title="#oooテーブル登録" xlink:actuate="onRequest" xlink:href="#oooテーブル登録" xlink:show="new" xlink:title="#oooテーブル登録" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="122" x="128.5" y="494.2852"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102" x="138.5" y="515.4238">OOOテーブル登録</text></a><a href="#コミット" target="_top" title="#コミット" xlink:actuate="onRequest" xlink:href="#コミット" xlink:show="new" xlink:title="#コミット" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="68" x="155.5" y="548.2539"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="48" x="165.5" y="569.3926">コミット</text></a><polygon fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" points="96,241.3516,283,241.3516,295,253.3516,283,265.3516,96,265.3516,84,253.3516,96,241.3516" style="stroke:#A80036;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="96" y="257.1597">foreach (chunks as 1000レコード)</text><a href="#View生成" target="_top" title="#View生成" xlink:actuate="onRequest" xlink:href="#View生成" xlink:show="new" xlink:title="#View生成" xlink:type="simple"><rect fill="#FEFECE" filter="url(#f1r2qlwpkt9pj7)" height="33.9688" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="73" x="153" y="648.2227"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="53" x="163" y="669.3613">View生成</text></a><ellipse cx="189.5" cy="713.1914" fill="#FFFFFF" filter="url(#f1r2qlwpkt9pj7)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="189.5" cy="713.1914" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="30" y2="50"/><polygon fill="#A80036" points="185.5,40,189.5,50,193.5,40,189.5,44" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="83.9688" y2="103.9688"/><polygon fill="#A80036" points="185.5,93.9688,189.5,103.9688,193.5,93.9688,189.5,97.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="137.9375" y2="157.9375"/><polygon fill="#A80036" points="185.5,147.9375,189.5,157.9375,193.5,147.9375,189.5,151.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="399.5859" y2="425.3164"/><polygon fill="#A80036" points="185.5,415.3164,189.5,425.3164,193.5,415.3164,189.5,419.3164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="459.2852" y2="494.2852"/><polygon fill="#A80036" points="185.5,484.2852,189.5,494.2852,193.5,484.2852,189.5,488.2852" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="528.2539" y2="548.2539"/><polygon fill="#A80036" points="185.5,538.2539,189.5,548.2539,193.5,538.2539,189.5,542.2539" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="319.3203" y2="365.6172"/><polygon fill="#A80036" points="185.5,355.6172,189.5,365.6172,193.5,355.6172,189.5,359.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="265.3516" y2="285.3516"/><polygon fill="#A80036" points="185.5,275.3516,189.5,285.3516,193.5,275.3516,189.5,279.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="582.2227" y2="604.2227"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="426.5" y1="604.2227" y2="604.2227"/><polygon fill="#A80036" points="422.5,432.1523,426.5,422.1523,430.5,432.1523,426.5,428.1523" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="426.5" x2="426.5" y1="253.3516" y2="604.2227"/><line style="stroke:#A80036;stroke-width:1.5;" x1="426.5" x2="295" y1="253.3516" y2="253.3516"/><polygon fill="#A80036" points="305,249.3516,295,253.3516,305,257.3516,301,253.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="84" x2="72" y1="253.3516" y2="253.3516"/><polygon fill="#A80036" points="68,418.1523,72,428.1523,76,418.1523,72,422.1523" style="stroke:#A80036;stroke-width:1.5;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="72" x2="72" y1="253.3516" y2="616.2227"/><line style="stroke:#A80036;stroke-width:1.5;" x1="72" x2="189.5" y1="616.2227" y2="616.2227"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="616.2227" y2="648.2227"/><polygon fill="#A80036" points="185.5,638.2227,189.5,648.2227,193.5,638.2227,189.5,642.2227" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="191.9063" y2="241.3516"/><polygon fill="#A80036" points="185.5,231.3516,189.5,241.3516,193.5,231.3516,189.5,235.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.5;" x1="189.5" x2="189.5" y1="682.1914" y2="702.1914"/><polygon fill="#A80036" points="185.5,692.1914,189.5,702.1914,193.5,692.1914,189.5,696.1914" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[728e3451dc98175bf540ab227e858785]
@startuml
start

[[#バリデーション]]:バリデーション;

[[#csvファイル読み込み]]:CSVファイル読み込み;
note right: 実装時は[[https://www.php.net/manual/ja/language.generators.overview.php Generator]]を使用し、1レコードずつ読み込む

:chunks = array_chunk(CSVファイルレコードリスト, 1000);
note right: 実装時は[[https://www.php.net/manual/en/function.array-chunk.php array_chunk]]ではなく\n[[https://www.php.net/manual/ja/language.generators.overview.php Generator]]で分割する

partition "foreach(chunks)" {
  while (foreach (chunks as 1000レコード))
    note right: 1000レコードずつ登録する

    [[#レコードバリデーション]]:レコードバリデーション;

    partition "トランザクション" #FFA500 {
      note right: [[https://www.php.net/manual/ja/pdo.transactions.php トランザクション]]

      [[#トランザクション開始]]:トランザクション開始;

      [[#xxxテーブル登録]]:XXXテーブル登録;

      [[#oooテーブル登録]]:OOOテーブル登録;

      [[#コミット]]:コミット;

    }
  endwhile
}

[[#View生成]]:View生成;

stop
@enduml

PlantUML version 1.2021.15beta6(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>